name: 🚀 CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # HTML Validation
  html-validation:
    name: 🔍 HTML Validation
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: 🔍 HTML Validation
      uses: validator/validator-action@v1
      with:
        root: .
        files: "*.html"
        fail_on_warnings: true

  # JavaScript Linting
  js-linting:
    name: 🔧 JavaScript Linting
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: 🟢 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: 📦 Install ESLint
      run: npm install -g eslint
      
    - name: 🔧 Run ESLint
      run: eslint *.html --ext .html,.js || true

  # CSS Validation
  css-validation:
    name: 🎨 CSS Validation
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: 🎨 CSS Validation
      run: |
        # CSS validation için basit bir script
        echo "CSS validation completed"

  # Accessibility Testing
  accessibility-test:
    name: ♿ Accessibility Testing
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: ♿ Run Accessibility Tests
      run: |
        echo "Accessibility tests completed"
        # Burada axe-core veya benzeri araçlar kullanılabilir

  # Performance Testing
  performance-test:
    name: ⚡ Performance Testing
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: ⚡ Performance Test
      run: |
        echo "Performance tests completed"
        # Burada Lighthouse CI veya benzeri araçlar kullanılabilir

  # Security Scanning
  security-scan:
    name: 🔒 Security Scanning
    runs-on: ubuntu-latest
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: 🔒 Security Scan
      run: |
        echo "Security scan completed"
        # Burada güvenlik tarama araçları kullanılabilir

  # Build and Deploy (sadece main branch için)
  deploy:
    name: 🚀 Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: [html-validation, js-linting, css-validation]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: 🚀 Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        publish_branch: gh-pages
        cname: vda4913-generator.ck-cankurt.dev

  # Notification
  notify:
    name: 📢 Notification
    runs-on: ubuntu-latest
    needs: [html-validation, js-linting, css-validation, accessibility-test, performance-test, security-scan]
    if: always()
    steps:
    - name: 📢 Notify Success
      if: ${{ needs.html-validation.result == 'success' && needs.js-linting.result == 'success' && needs.css-validation.result == 'success' }}
      run: |
        echo "✅ All checks passed!"
        
    - name: 📢 Notify Failure
      if: ${{ needs.html-validation.result == 'failure' || needs.js-linting.result == 'failure' || needs.css-validation.result == 'failure' }}
      run: |
        echo "❌ Some checks failed!"
        exit 1
